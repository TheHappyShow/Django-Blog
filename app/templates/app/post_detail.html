{% extends "base.html" %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow">
        {% if article.thumbnail %}
        <img src="{{ article.thumbnail.url }}" class="card-img-top" alt="{{ article.title }}">
        {% endif %}
        <div class="card-body">
            <h2 class="card-title">{{ article.title }}</h2>
            <p class="text-muted">
                –ö–∞—Ç–µ–≥–æ—Ä–∏—è: <strong>{{ article.category.name }}</strong> |
                –ê–≤—Ç–æ—Ä: <strong>{{ article.user.username }}</strong> |
                –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ article.view_count }}
            </p>
            <hr>
            <div class="card-text">
                {{ article.description|safe }}
            </div>
            <hr>
            <small class="text-muted">
                –°–æ–∑–¥–∞–Ω–æ: {{ article.created_at|date:"d.m.Y H:i" }}<br>
                –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ article.updated_at|date:"d.m.Y H:i" }}
                {% if request.user.is_superuser or request.user == article.user %}
                <a href="{% url 'article_update' article.slug %}" class="btn btn-primary btn-sm ms-2">
                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal"
                        data-bs-target="#deleteArticleModal{{ article.pk }}">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
                {% include 'app/post_delete.html' %}
                {% endif %}
            </small>
        </div>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
{% if user.is_authenticated %}
<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h5>
            <form method="post" action="{% url 'comment_create' article.slug %}">
                {% csrf_token %}
                <div class="mb-3">
                    {{ comment_form.text.label_tag }}
                    <textarea name="text" class="form-control" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–¥–µ—Å—å...">
                        {{ comment_form.text.value|default_if_none:"" }}
                    </textarea>
                    {% if comment_form.text.errors %}
                    <div class="text-danger small">{{ comment_form.text.errors.0 }}</div>
                    {% endif %}
                </div>
                <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>
</div>
{% else %}
<div class="container mt-5">
    <div class="alert alert-warning">
        <a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.
    </div>
</div>
{% endif %}

<!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
<div class="container mt-5">
    <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments.count }})</h4>
    {% if comments %}
    <ul class="list-group">
        {% for comment in comments %}
        <li class="list-group-item">
            <strong>{{ comment.user.username }}</strong>
            <span class="text-muted small">‚Äî {{ comment.created_at|date:"d.m.Y H:i" }}</span>
            <p class="mt-2 mb-1">{{ comment.text }}</p>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
</div>

{% endblock %}
